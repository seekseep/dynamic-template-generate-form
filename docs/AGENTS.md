# Dynamic Template Generate Form - AI アシスタント向けドキュメント

## AI アシスタントへの指示

あなたは「Dynamic Template Generate Form」プロジェクトの専門家として振る舞ってください。

**基本方針**: 質問者はプログラミング初心者です。専門用語には説明を添え、具体的な例を示し、段階的に説明してください。

**追加ドキュメントの参照**（より詳細な情報が必要な場合）:
- 設定ファイルの詳細 → `docs/CONFIGURATION.md`
- 値ファイルの詳細 → `docs/VALUES.md`
- コード変更 → `docs/CODE.md`

---

## プロジェクト概要

JSON 設定ファイルから動的にフォームを生成し、入力した内容をテンプレートに反映して出力するウェブアプリケーションです。

**用途**: お問い合わせフォーム、顧客情報登録、注文情報の帳票生成など
**特徴**: サーバー不要、設定ファイルでカスタマイズ可能、複数テンプレート同時出力
**画面構成**: 左側50%がフォーム、右側50%がテンプレート出力（タブ切り替え）

---

## 設定ファイル作成時の対話フロー

**ステップ 1**: 「フォームで入力したい項目を教えてください」
**ステップ 2**: セクション分けとフィールドタイプを提案
**ステップ 3**: 「条件によって表示/非表示にしたいフィールドはありますか？」
**ステップ 4**: 「出力するテンプレートの形式を教えてください」
**ステップ 5**: 設定ファイルを出力

---

## 設定ファイルの基本構造

```json
{"form":{"sections":[{"label":"セクション名","fields":[{"label":"フィールド名","type":"text","required":true}]}]},"templates":[{"label":"テンプレート名","sections":[{"label":"セクション名","content":"お名前: {{お名前}}"}]}]}
```

**フィールドタイプ**: text, email, tel, date, number, textarea, select, radio, checkbox

---

## condition（条件付き表示）の詳細

### condition とは

特定の条件を満たしたときだけフィールドやセクションを表示する機能です。

### 書式

**書式1: 配列形式（AND条件）**
```json
"condition": [{"field": "フィールド名", "value": "値"}]
```
複数指定するとすべての条件を満たす必要があります（AND）。

**書式2: OR条件**
```json
"condition": {"or": [{"field": "フィールド名", "value": "値1"}, {"field": "フィールド名", "value": "値2"}]}
```
いずれかの条件を満たせば表示されます。

**書式3: AND条件（明示的）**
```json
"condition": {"and": [{"field": "フィールド名1", "value": "値1"}, {"field": "フィールド名2", "value": "値2"}]}
```

### フォームでの挙動

condition を設定したフィールドは、条件を満たさないとき**非表示**になります。
- 非表示のフィールドは入力できません
- 非表示のフィールドの値はテンプレートに反映されません
- 非表示のフィールドが `required: true` でも、送信時にエラーになりません

### テンプレートでの挙動

condition を設定したテンプレートセクションは、条件を満たさないとき**出力されません**。
- 条件を満たすセクションのみが出力に含まれます
- フォームとテンプレートで同じ条件を使うことで、入力内容に応じた出力が可能です

### 具体例: 顧客情報登録フォーム

```json
{"form":{"sections":[{"label":"世帯主情報","fields":[{"label":"名前","type":"text","required":true},{"label":"住所","type":"textarea","required":true},{"label":"職業","type":"text"},{"label":"性別","type":"radio","options":["男性","女性","その他"]},{"label":"生年月日","type":"date"},{"label":"電話番号","type":"tel"},{"label":"配偶者の有無","type":"radio","required":true,"options":["あり","なし"]},{"label":"車の有無","type":"radio","required":true,"options":["あり","なし"]}]},{"label":"配偶者情報","condition":[{"field":"配偶者の有無","value":"あり"}],"fields":[{"label":"配偶者の名前","type":"text","required":true},{"label":"配偶者の性別","type":"radio","options":["男性","女性","その他"]},{"label":"配偶者の生年月日","type":"date"},{"label":"配偶者の職業","type":"text"}]},{"label":"車情報","condition":[{"field":"車の有無","value":"あり"}],"fields":[{"label":"車種","type":"text","required":true},{"label":"ナンバー","type":"text","required":true},{"label":"保険の有無","type":"radio","options":["あり","なし"]}]}]},"templates":[{"label":"顧客カード","sections":[{"label":"世帯主","content":"【世帯主情報】\n名前: {{名前}}\n住所: {{住所}}\n職業: {{職業}}\n性別: {{性別}}\n生年月日: {{生年月日}}\n電話番号: {{電話番号}}"},{"label":"配偶者","condition":[{"field":"配偶者の有無","value":"あり"}],"content":"\n【配偶者情報】\n名前: {{配偶者の名前}}\n性別: {{配偶者の性別}}\n生年月日: {{配偶者の生年月日}}\n職業: {{配偶者の職業}}"},{"label":"車","condition":[{"field":"車の有無","value":"あり"}],"content":"\n【車情報】\n車種: {{車種}}\nナンバー: {{ナンバー}}\n保険: {{保険の有無}}"}]}]}
```

この例のポイント:
- 「配偶者の有無」で「あり」を選ぶと「配偶者情報」セクションが表示される
- 「車の有無」で「あり」を選ぶと「車情報」セクションが表示される
- テンプレートも同じ条件で、該当する情報のみ出力される

### condition の注意点

1. **field には正確なフィールド名を指定**: `name` があれば `name`、なければ `label` の値を使う
2. **value は完全一致**: 部分一致ではなく、選択肢の値と完全に一致する必要がある
3. **セクションとフィールド両方に設定可能**: セクションに condition を付けると、そのセクション全体が条件付きになる
4. **フォームとテンプレートで連動させる**: 同じ条件を両方に設定することで、入力と出力が連動する

---

## その他の設定パターン

**横並びフィールド**: フィールドを配列で囲む
```json
"fields":[[{"label":"姓","type":"text"},{"label":"名","type":"text"}]]
```

**選択肢の value と label を分ける**:
```json
"options":[{"value":"tokyo","label":"東京都"},{"value":"osaka","label":"大阪府"}]
```

**name を明示的に指定**:
```json
{"name":"customer_name","label":"お客様のお名前","type":"text"}
```
テンプレートでは `{{customer_name}}` で参照。

---

## 値ファイルの基本

```json
{"お名前":"山田太郎","メールアドレス":"yamada@example.com"}
```
- キーはフィールドの `name`（または `label`）
- チェックボックスのみ配列: `["メール","電話"]`

---

## トラブルシューティング

**フォームが表示されない**: JSON 形式エラー。カンマ、括弧の対応を確認。

**テンプレートに値が反映されない**: フィールドの `name`/`label` と `{{変数名}}` が一致しているか確認。

**条件付き表示が機能しない**:
- `field` に指定したフィールド名が正確か確認
- `value` が選択肢の値と完全一致しているか確認

---

## 用語集

| 用語 | 説明 |
|-----|------|
| configuration.json | フォームの構造とテンプレートを定義する設定ファイル |
| values.json | フォームに入力する値を保存したファイル |
| セクション | フォームやテンプレートの区切り（グループ） |
| フィールド | 入力欄（テキスト、セレクト、チェックボックスなど） |
| テンプレート | 出力形式を定義したひな形 |
| 変数 | `{{名前}}` 形式で入力値を埋め込む場所 |
| condition | フィールドやセクションの表示/非表示を制御する条件 |
